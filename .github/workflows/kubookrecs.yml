# Add this job (or replace your run-bot job temporarily)
jobs:
  auth-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Install PRAW
        run: |
          python -m pip install --upgrade pip
          pip install praw
      - name: Show repo tree (debug)
        run: |
          pwd
          ls -la
      - name: Test Reddit auth
        env:
          REDDIT_CLIENT_ID:     ${{ secrets.REDDIT_CLIENT_ID }}
          REDDIT_CLIENT_SECRET: ${{ secrets.REDDIT_CLIENT_SECRET }}
          REDDIT_USERNAME:      ${{ secrets.REDDIT_USERNAME }}
          REDDIT_PASSWORD:      ${{ secrets.REDDIT_PASSWORD }}
          REDDIT_USER_AGENT:    ${{ secrets.REDDIT_USER_AGENT }}
        run: |
          python - <<'PY'
          import os, sys, praw
          print("Client ID present:", bool(os.getenv("REDDIT_CLIENT_ID")))
          print("Client Secret present:", bool(os.getenv("REDDIT_CLIENT_SECRET")))
          print("Username present:", bool(os.getenv("REDDIT_USERNAME")))
          print("Password present:", bool(os.getenv("REDDIT_PASSWORD")))
          reddit = praw.Reddit(
              client_id=os.environ["REDDIT_CLIENT_ID"],
              client_secret=os.environ["REDDIT_CLIENT_SECRET"],
              username=os.environ["REDDIT_USERNAME"],
              password=os.environ["REDDIT_PASSWORD"],
              user_agent=os.getenv("REDDIT_USER_AGENT","KUBookRecsBot:v1.0 (by u/Arijenn2891)"),
              check_for_async=False,
          )
          try:
              me = reddit.user.me()
              print("✅ Logged in as:", me)
          except Exception as e:
              print("❌ Auth failed:", repr(e))
              sys.exit(1)
          PY
